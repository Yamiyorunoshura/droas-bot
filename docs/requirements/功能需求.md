## 功能需求


### 用戶帳戶管理

**REQ-001**: 自動帳戶創建
- **描述**: 當用戶首次與機器人互動時，自動為其在所在伺服器創建帳戶
- **優先級**: 高
- **驗收標準**:
  - Given 新用戶在 Discord 伺服器中首次執行機器人指令
  - When 系統檢測到用戶帳戶不存在
  - Then 自動創建用戶帳戶，初始餘額為 0
  - And 帳戶與 Discord 用戶 ID 和伺服器 ID 綁定

**REQ-002**: 帳戶識別
- **描述**: 通過 Discord 用戶 ID 和伺服器 ID 唯一識別用戶帳戶
- **優先級**: 高
- **驗收標準**:
  - Given 用戶在特定 Discord 伺服器中執行指令
  - When 系統處理指令時
  - Then 能正確識別用戶在該伺服器的帳戶
  - And 不同伺服器中的同一用戶擁有獨立帳戶

### 餘額查詢系統

**REQ-003**: 查詢自己餘額
- **描述**: 用戶可以查詢自己在當前伺服器的餘額
- **優先級**: 高
- **驗收標準**:
  - Given 用戶在 Discord 伺服器中
  - When 用戶執行 `/balance` 指令（不帶參數）
  - Then 系統回應用戶的當前餘額，包含貨幣符號和格式化顯示
  - And 該回應只有用戶本人可見

**REQ-004**: 查詢他人餘額
- **描述**: 用戶可以查詢其他用戶在當前伺服器的餘額
- **優先級**: 中
- **驗收標準**:
  - Given 用戶在 Discord 伺服器中
  - When 用戶執行 `/balance` 指令，提供 `user` 參數
  - Then 系統回應指定用戶的當前餘額
  - And 該回應只有查詢者本人可見
  - And 無需被查詢用戶同意

**REQ-005**: 餘額格式化顯示
- **描述**: 根據伺服器設定格式化顯示餘額（小數位數、千分位）
- **優先級**: 中
- **驗收標準**:
  - Given 伺服器已設定貨幣顯示格式
  - When 系統顯示金額時
  - Then 按設定顯示小數點後 2 位
  - And 根據設定決定是否顯示千分位分隔符
  - And 包含伺服器設定的貨幣符號/名稱

### 轉帳系統

**REQ-006**: 發起轉帳請求
- **描述**: 用戶可以發起轉帳給其他用戶
- **優先級**: 高
- **驗收標準**:
  - Given 用戶有足夠餘額進行轉帳
  - When 用戶執行 `/transfer` 指令，提供有效的收款人、金額和可選備註
  - Then 系統驗證所有參數並執行轉帳
  - And 生成唯一交易編號
  - And 通知收款方（僅收款方可見）
  - And 回應轉帳結果給發送方（僅發送方可見）

**REQ-007**: 轉帳驗證
- **描述**: 系統必須驗證轉帳請求的有效性
- **優先級**: 高
- **驗收標準**:
  - Given 用戶發起轉帳請求
  - When 系統處理轉帳時
  - Then 驗證金額 > 0 且小數點不超過 2 位
  - And 驗證收款人不是發送人本人
  - And 驗證發送人有足夠餘額
  - And 若驗證失敗，回應具體錯誤訊息

**REQ-008**: 執行轉帳交易
- **描述**: 系統執行原子性的轉帳操作
- **優先級**: 高
- **驗收標準**:
  - Given 轉帳請求通過所有驗證
  - When 系統執行轉帳時
  - Then 減少發送人餘額
  - And 增加收款人餘額
  - And 確保交易的原子性（要么全部成功，要么全部失敗）

**REQ-009**: 生成交易編號
- **描述**: 為每筆轉帳生成唯一交易編號
- **優先級**: 中
- **驗收標準**:
  - Given 系統執行轉帳交易
  - When 交易完成時
  - Then 生成唯一的交易編號
  - And 交易編號包含在回應中
  - And 交易編號可用於稽核查詢

**REQ-010**: 發送轉帳通知
- **描述**: 成功轉帳後通知收款方
- **優先級**: 中
- **驗收標準**:
  - Given 轉帳交易成功完成
  - When 交易完成時
  - Then 發送通知給收款方
  - And 通知包含發送人、金額、備註（如有）和交易編號
  - And 該通知只有收款方本人可見

### 管理調整系統

**REQ-011**: 管理者權限驗證
- **描述**: 驗證執行管理指令的用戶具有適當權限
- **優先級**: 高
- **驗收標準**:
  - Given 用戶嘗試執行管理指令
  - When 用戶執行 `/adjust` 指令
  - Then 系統檢查用戶是否有 Discord Administrator 權限
  - And 若無權限則回應錯誤訊息
  - And 若有權限則繼續執行指令

**REQ-012**: 執行餘額調整
- **描述**: 管理者可以調整指定用戶的餘額
- **優先級**: 高
- **驗收標準**:
  - Given 管理者有權限執行調整
  - When 管理者執行 `/adjust` 指令，指定用戶、操作類型和金額
  - Then 系統根據操作類型（add/remove/set）調整用戶餘額
  - And 支持調整後餘額為負值
  - And 記錄調整操作和理由

**REQ-013**: 調整記錄和理由
- **描述**: 記錄所有管理調整操作的詳細信息
- **優先級**: 中
- **驗收標準**:
  - Given 管理者執行餘額調整
  - When 調整完成時
  - Then 記錄調整前後餘額、操作類型、理由和交易編號
  - And 記錄包含操作者、目標用戶和時間戳
  - And 記錄可用於稽核查詢

### 稽核日誌系統

**REQ-014**: 記錄所有交易
- **描述**: 系統必須記錄所有轉帳和調整交易
- **優先級**: 高
- **驗收標準**:
  - Given 發生轉帳或調整交易
  - When 交易完成時
  - Then 記錄交易的所有相關信息
  - And 包含時間、操作者、對象、動作、金額、理由/備註、交易編號

**REQ-015**: 查詢稽核記錄
- **描述**: 管理者可以查詢管理操作和關聯交易記錄
- **優先級**: 中
- **驗收標準**:
  - Given 管理者執行 `/audit` 指令
  - When 系統處理查詢時
  - Then 回應最近 50 筆記錄
  - And 按時間降序排列
  - And 包含完整的交易信息
  - And 該回應只有查詢的管理者可見

**REQ-016**: 稽核權限控制
- **描述**: 限制稽核查詢僅限管理者使用
- **優先級**: 高
- **驗收標準**:
  - Given 用戶嘗試執行稽核查詢
  - When 用戶執行 `/audit` 指令
  - Then 系統驗證用戶有 Discord Administrator 權限
  - And 若無權限則回應錯誤訊息

### 說明系統

**REQ-017**: 顯示通用指令說明
- **描述**: 提供所有可用指令的概覽說明
- **優先級**: 中
- **驗收標準**:
  - Given 用戶執行 `/help` 指令（不帶參數）
  - When 系統處理請求時
  - Then 顯示所有可用指令的簡要說明
  - And 包含指令用途和基本語法
  - And 該回應只有用戶本人可見

**REQ-018**: 顯示特定指令詳細說明
- **描述**: 提供特定指令的詳細使用說明和範例
- **優先級**: 中
- **驗收標準**:
  - Given 用戶執行 `/help` 指令，提供 `command` 參數
  - When 系統處理請求時
  - Then 顯示指定指令的詳細說明
  - And 包含參數說明和使用範例
  - And 該回應只有用戶本人可見

### 排行榜系統

**REQ-019**: 餘額排行榜
- **描述**: 顯示按餘額排序的用戶排行榜
- **優先級**: 低
- **驗收標準**:
  - Given 用戶執行 `/leaderboard` 指令（使用預設參數）
  - When 系統處理請求時
  - Then 顯示按餘額降序排列的前 10 名用戶
  - And 包含名次、用戶和餘額
  - And 餘額按伺服器設定格式顯示
  - And 該回應只有用戶本人可見

**REQ-020**: 轉帳次數排行榜
- **描述**: 顯示按轉帳次數排序的用戶排行榜
- **優先級**: 低
- **驗收標準**:
  - Given 用戶執行 `/leaderboard` 指令，指定 `metric` 為 `transfer_count`
  - When 系統處理請求時
  - Then 顯示按轉帳次數降序排列的用戶
  - And 包含名次、用戶和轉帳次數
  - And 該回應只有用戶本人可見

**REQ-021**: 排行榜參數控制
- **描述**: 支援排行榜的各種參數設定
- **優先級**: 低
- **驗收標準**:
  - Given 用戶執行 `/leaderboard` 指令，提供不同參數
  - When 系統處理請求時
  - Then 支援 `metric` 參數（balance/transfer_count）
  - And 支援 `limit` 參數（預設 10，最大 10）
  - And 同分時以最近活動時間優先排序

### 伺服器配置

**REQ-022**: 貨幣符號設定
- **描述**: 管理者可以設定伺服器的貨幣符號
- **優先級**: 中
- **驗收標準**:
  - Given 管理者需要設定貨幣符號
  - When 管理者提供貨幣符號
  - Then 系統保存該設定
  - And 在顯示金額時使用該符號

**REQ-023**: 貨幣名稱設定
- **描述**: 管理者可以設定伺服器的貨幣名稱
- **優先級**: 中
- **驗收標準**:
  - Given 管理者需要設定貨幣名稱
  - When 管理者提供貨幣名稱
  - Then 系統保存該設定
  - And 在相關回應中使用該名稱

**REQ-024**: 千分位顯示設定
- **描述**: 管理者可以設定是否顯示千分位分隔符
- **優先級**: 低
- **驗收標準**:
  - Given 管理者需要設定千分位顯示
  - When 管理者選擇啟用或停用千分位
  - Then 系統保存該設定
  - And 在顯示金額時遵循該設定

